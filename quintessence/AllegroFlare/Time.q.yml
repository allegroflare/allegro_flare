properties:


  - name: started_at
    type: float
    init_with: 0.0f
    constructor_arg: true
    getter: true
    setter: true

  - name: playhead
    type: float
    init_with: 0.0f

  - name: rate
    type: float
    init_with: 0.0f

  - name: last_rate_changed_at
    type: float
    init_with: 0.0f


methods:


  - name: absolute_now
    type: float
    guards: [ al_is_system_installed() ]
    body: |
      return al_get_time();
    body_dependency_symbols:
      - al_is_system_installed


  - name: now
    type: float
    guards: [ al_is_system_installed() ]
    body: |
      float time_now = al_get_time();
      float rate_window_age = time_now - last_rate_changed_at;
      playhead += (rate_window_age * rate);
      return playhead;
    body_dependency_symbols:
      - al_is_system_installed


  - name: jump_ahead_sec
    parameters:
      - name: distance
        type: float
        default_argument: 0.0f
    guards: [ distance >= 0.0 ]
    body: |
      // TODO: Consider and account for possible overflows
      playhead += distance;


  - name: set_rate
    parameters:
      - name: rate
        type: float
        default_argument: 1.0f
    guards: [ rate >= 0.0001 ]
    body: |
      last_rate_changed_at = absolute_now();
      this->rate = rate;
      return;


dependencies:


  - symbol: al_is_system_installed
    headers: [ allegro5/allegro.h ]


