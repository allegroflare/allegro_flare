parent_classes:


  - class: AllegroFlare::Elements::Backgrounds::Base
    scope: public
    init_with: AllegroFlare::Elements::Backgrounds::VideoIdentifier::TYPE


properties:


  - name: video_bin
    type: AllegroFlare::VideoBin*
    init_with: nullptr
    constructor_arg: true

  - name: video_identifier
    type: std::string
    init_with: '"[unset-video_identifier]"'
    constructor_arg: true

  - name: TYPE
    type: char*
    init_with: '(char*)"AllegroFlare/Elements/Backgrounds/VideoIdentifier"'
    static: true
    constexpr: true


functions:


  - name: activate
    override: true
    guards: [ video_bin ]
    body: |
      // Should this logic be in the "show" function instead?
      ALLEGRO_VIDEO *video = obtain_video();
      if (video)
      {
         al_start_video(video, al_get_default_mixer());
         std::cout << "video FPS: " << al_get_video_fps(video) << std::endl;
         std::cout << "video audio rate: " << al_get_video_audio_rate(video) << std::endl;
      }
      return;


  - name: deactivate
    override: true
    guards: [ video_bin ]
    body: |
      ALLEGRO_VIDEO *video = obtain_video();
      if (video) al_set_video_playing(video, false);
      return;


  - name: render
    override: true
    guards: [ video_bin ]
    body: |
      ALLEGRO_VIDEO *video = obtain_video();
      if (!video) return;

      bool video_is_playing = al_is_video_playing(video);
      if (!video_is_playing) return;
 
      ALLEGRO_BITMAP* frame = al_get_video_frame(video);
      if (!frame) return;

      float scale = 1.0;
      float sw = al_get_bitmap_width(frame);
      float sh = al_get_bitmap_height(frame);
      float dw = scale * al_get_video_scaled_width(video);
      float dh = scale * al_get_video_scaled_height(video);
      al_draw_scaled_bitmap(frame, 0, 0, sw, sh, 0, 0, dw, dh, 0);
      return;


  - name: obtain_video
    type: ALLEGRO_VIDEO*
    private: true
    guards: [ video_bin ]
    body: |
      return video_bin->auto_get(video_identifier);


dependencies:


  - symbol: ALLEGRO_VIDEO
    headers: [ allegro5/allegro.h ]
  - symbol: AllegroFlare::VideoBin
    headers: [ AllegroFlare/VideoBin.hpp ]
  - symbol: AllegroFlare::Elements::Backgrounds::Base
    headers: [ AllegroFlare/Elements/Backgrounds/Base.hpp ]
  - symbol: AllegroFlare::Placement2D
    headers: [ AllegroFlare/Placement2D.hpp ]


