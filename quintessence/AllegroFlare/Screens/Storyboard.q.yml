parent_classes:


  - class: AllegroFlare::Screens::Base
    scope: public
    init_with: ''


properties:


  - name: font_bin
    type: AllegroFlare::FontBin*
    init_with: nullptr
    constructor_arg: true
    setter: true

  - name: event_emitter
    type: AllegroFlare::EventEmitter*
    init_with: nullptr
    constructor_arg: true
    setter: true

  - name: storyboard_element
    type: AllegroFlare::Elements::Storyboard
    init_with: '{}'
    getter_ref: true
    setter: false

  - name: screen_identifier_to_switch_to_after_completing
    type: std::string
    init_with: '""'
    constructor_arg: true
    setter: true

  - name: game_event_name_to_emit_after_completing
    type: std::string
    init_with: '"storyboard_finished"'
    constructor_arg: true
    getter: true
    setter: true

  - name: initialized
    type: bool
    init_with: false


functions:


  - name: initialize
    guards: [ (!initialized) ]
    body: |
      storyboard_element.set_font_bin(font_bin);
      initialized = true;
      return;


  - name: on_activate
    virtual: true
    override: true
    guards: [ initialized ] 
    body: |
      storyboard_element.reset();
      return;


  - name: primary_timer_func
    virtual: true
    override: true
    guards: [ initialized ] 
    body: |
      storyboard_element.render();
      return;


  - name: key_down_func
    virtual: true
    override: true
    parameters:
      - name: event
        type: ALLEGRO_EVENT*
        default_argument: nullptr
    guards: [ initialized, event_emitter ]
    body: |
      if (storyboard_element.get_finished()) return;

      storyboard_element.advance_page();

      if (storyboard_element.get_finished())
      {
         if (!screen_identifier_to_switch_to_after_completing.empty())
         {
            event_emitter->emit_switch_screen_event(screen_identifier_to_switch_to_after_completing);
         }
         if (!game_event_name_to_emit_after_completing.empty())
         {
            event_emitter->emit_game_event(AllegroFlare::GameEvent("storyboard_finished"));
         }
      }

      return;


dependencies:


  - symbol: AllegroFlare::Elements::Storyboard
    headers: [ AllegroFlare/Elements/Storyboard.hpp ]
  - symbol: AllegroFlare::Color
    headers: [ AllegroFlare/Color.hpp ]
  - symbol: AllegroFlare::Screens::Base
    headers: [ AllegroFlare/Screens/Base.hpp ]
  - symbol: AllegroFlare::EventEmitter*
    headers: [ AllegroFlare/EventEmitter.hpp ]
  - symbol: AllegroFlare::FontBin*
    headers: [ AllegroFlare/FontBin.hpp ]
  - symbol: ALLEGRO_FONT*
    headers: [ allegro5/allegro_font.h ]
  - symbol: ALLEGRO_EVENT*
    headers: [ allegro5/allegro.h ]
  - symbol: ALLEGRO_COLOR
    headers: [ allegro5/allegro.h ]
  - symbol: al_draw_multiline_text
    headers: [ allegro5/allegro_font.h ]


