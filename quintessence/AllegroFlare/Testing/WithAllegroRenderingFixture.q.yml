parent_classes:


  - class: ::testing::Test
    scope: public
    init_with: ''


properties:


  - name: display
    type: ALLEGRO_DISPLAY*
    init_with: nullptr
    getter: true

  - name: font_bin
    type: AllegroFlare::FontBin
    init_with: '{}'
    getter_ref: true

  - name: bitmap_bin
    type: AllegroFlare::BitmapBin
    init_with: '{}'
    getter_ref: true


functions:


  - name: SetUp
    type: void
    virtual: true
    override: true
    body: |
      ASSERT_EQ(false, al_is_system_installed());
      ASSERT_EQ(true, al_init());
      al_init_primitives_addon();
      al_init_font_addon();
      al_init_ttf_addon();
      al_init_image_addon();

      #ifdef _WIN32
      // NOTE  was in  Repos/Krampus21
      #define TEST_FIXTURE_FONT_FOLDER "/msys64/home/Mark/Repos/allegro_flare/bin/data/fonts/"
      #define TEST_FIXTURE_BITMAP_FOLDER "/msys64/home/Mark/Repos/allegro_flare/bin/data/bitmaps/"
      #else
      #define TEST_FIXTURE_FONT_FOLDER "/Users/markoates/Repos/allegro_flare/bin/data/fonts/"
      #define TEST_FIXTURE_BITMAP_FOLDER "/Users/markoates/Repos/allegro_flare/bin/data/bitmaps/"
      #endif

      font_bin.set_full_path(TEST_FIXTURE_FONT_FOLDER);
      bitmap_bin.set_full_path(TEST_FIXTURE_BITMAP_FOLDER);

      //display = al_create_display(1280 * 2, 720 * 2);
      display = al_create_display(1920, 1080);
      al_clear_to_color(ALLEGRO_COLOR{0.05f, 0.05f, 0.05f, 0.05f});
      return;
    body_dependency_symbols:
      - al_init_image_addon
      - al_init_font_addon
      - al_init_ttf_addon
      - al_init_primitives_addon


  - name: TearDown
    type: void
    virtual: true
    override: true
    body: |
      font_bin.clear();
      bitmap_bin.clear();
      al_destroy_display(display);
      al_shutdown_ttf_addon(); // this is required otherwise subsequent al_init_ttf_addon will not work
                               // this is a bug in Allegro
      al_uninstall_system();
      return;


  - name: get_any_font
    type: ALLEGRO_FONT*
    body: |
      return font_bin.auto_get("consolas.ttf 32");


  - name: sleep_for_frame
    type: void
    body: |
      static int frame_length_in_milliseconds = 1000/60;
      std::this_thread::sleep_for(std::chrono::milliseconds(frame_length_in_milliseconds));
    body_dependency_symbols:
      - std::chrono::milliseconds
      - std::this_thread::sleep_for


  - name: sleep_for
    type: void
    parameters:
      - name: length_in_seconds
        type: float
        default_argument: 0.0f
    body: |
      int length_in_milliseconds = (int)(length_in_seconds * 1000.0);
      std::this_thread::sleep_for(std::chrono::milliseconds(length_in_milliseconds));
    body_dependency_symbols:
      - std::chrono::milliseconds
      - std::this_thread::sleep_for


  - name: get_test_name
    type: std::string
    body: |
      const testing::TestInfo* const test_info = testing::UnitTest::GetInstance()->current_test_info();
      return test_info->name();


  - name: get_test_suite_name
    type: std::string
    body: |
      const testing::TestInfo* const test_info = testing::UnitTest::GetInstance()->current_test_info();
      return test_info->test_suite_name();


  - name: build_centered_placement
    type: AllegroFlare::Placement2D
    parameters:
      - name: width
        type: float
        default_argument: 0.0f
      - name: height
        type: float
        default_argument: 0.0f
    guards: [ al_get_target_bitmap() ]
    body: |
      AllegroFlare::Placement2D place(al_get_display_width(display)/2, al_get_display_height(display)/2, width, height);
      return place;


dependencies:


  - symbol: AllegroFlare::Testing::CustomComparison
    headers: [ AllegroFlare/Testing/CustomComparison.hpp ]
  - symbol: al_init_primitives_addon
    headers: [ allegro5/allegro_primitives.h ]
  - symbol: al_init_ttf_addon
    headers: [ allegro5/allegro_ttf.h ]
  - symbol: al_init_font_addon
    headers: [ allegro5/allegro_font.h ]
  - symbol: al_init_image_addon
    headers: [ allegro5/allegro_image.h ]
  - symbol: ALLEGRO_DISPLAY*
    headers: [ allegro5/allegro.h ]
  - symbol: ALLEGRO_FONT*
    headers: [ allegro5/allegro_font.h ]
  - symbol: AllegroFlare::FontBin
    headers: [ AllegroFlare/FontBin.hpp ]
  - symbol: AllegroFlare::BitmapBin
    headers: [ AllegroFlare/BitmapBin.hpp ]
  - symbol: ::testing::Test
    headers: [ gtest/gtest.h ]
  - symbol: AllegroFlare::Placement2D
    headers: [ AllegroFlare/Placement2D.hpp ]
  - symbol: std::chrono::milliseconds
    headers: [ chrono ]
  - symbol: std::this_thread::sleep_for
    headers: [ thread ]


